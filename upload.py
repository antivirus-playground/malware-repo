import os
import sys
from mwdblib import MWDB

URL = 'http://13.81.204.102/api'
KEY = 'API_KEY'


def upload_file(db, path, name, tag=None):
    print(path, title)
    f = open(path, "rb")
    raw = f.read()
    f.close()
    
    file_object = db.upload_file(name, raw)
    if tag is not None:
        file_object.add_tag(tag)


if __name__ == '__main__':
    if len(sys.argv) != 2:
        print(f"Usage: {sys.argv[0]} <directory>")
        sys.exit(1)

    mwdb = MWDB(api_url=URL, api_key=KEY) 

    directory = sys.argv[1]
    for root, dirs, files in os.walk(directory):
        title = root[len(directory):]
        for f in files:
            path = os.path.join(root, f)
            upload_file(mwdb, path, f, title)
